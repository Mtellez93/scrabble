<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Scrabble TV</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px; }
        .layout { display: flex; gap: 30px; align-items: flex-start; }
        .board-container { display: grid; grid-template-columns: 45px 1fr; grid-template-rows: 45px 1fr; background: #2d3436; padding: 15px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .coords-x, .coords-y { display: grid; gap: 2px; }
        .coords-x { grid-column: 2; grid-template-columns: repeat(15, 45px); }
        .coords-y { grid-row: 2; grid-template-rows: repeat(15, 45px); }
        .label { display: flex; align-items: center; justify-content: center; font-weight: bold; color: #f1c40f; font-size: 1.1em; }
        #board { grid-row: 2; grid-column: 2; display: grid; grid-template-columns: repeat(15, 45px); grid-template-rows: repeat(15, 45px); gap: 2px; background: #34495e; }
        .cell { width: 45px; height: 45px; background: #ecf0f1; color: #2c3e50; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.4em; border-radius: 4px; }
        .tp { background: #e74c3c !important; } .dp { background: #ff7675 !important; }
        .ficha { background: #f1c40f !important; animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { from { transform: scale(0.5); } to { transform: scale(1); } }
        .side { width: 300px; }
        .box { background: #1e272e; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-top: 4px solid #f1c40f; }
        .player-card { padding: 10px; margin-top: 8px; background: #2d3436; border-radius: 5px; display: flex; justify-content: space-between; border: 2px solid transparent; }
        .active { border-color: #f1c40f; background: #34495e; }
        #toast { position: fixed; top: 20px; background: #e67e22; color: white; padding: 15px 30px; border-radius: 30px; display: none; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 100; }
    </style>
</head>
<body>
    <div id="toast"></div>
    <h1 style="color:#f1c40f">SALA: <span id="room-id">--</span></h1>
    <div class="layout">
        <div class="board-container">
            <div></div><div id="lx" class="coords-x"></div><div id="ly" class="coords-y"></div>
            <div id="board"></div>
        </div>
        <div class="side">
            <div class="box"><h3>JUGADORES</h3><div id="players"></div></div>
            <div class="box"><h3>HISTORIAL</h3><div id="history" style="max-height: 400px; overflow-y: auto;"></div></div>
        </div>
    </div>
    <script>
        const socket = io();
        const b = document.getElementById('board');
        for(let i=0; i<15; i++) {
            document.getElementById('lx').innerHTML += `<div class="label">${i}</div>`;
            document.getElementById('ly').innerHTML += `<div class="label">${i}</div>`;
            for(let j=0; j<15; j++) {
                const c = document.createElement('div');
                c.className = 'cell'; c.id = `cell-${j}-${i}`;
                if((j==0||j==7||j==14)&&(i==0||i==7||i==14)&&!(j==7&&i==7)) c.classList.add('tp');
                b.appendChild(c);
            }
        }
        socket.emit('create-game');
        socket.on('game-created', code => document.getElementById('room-id').innerText = code);
        socket.on('update-game-state', s => {
            document.getElementById('players').innerHTML = s.players.map(p => `
                <div class="player-card ${p.id==s.turnOwner?'active':''}">
                    <span>${p.name} ${p.id==s.turnOwner?'⚡':''}</span><b>${p.score} pts</b>
                </div>`).join('');
        });
        socket.on('player-passed', name => {
            const t = document.getElementById('toast');
            t.innerText = `⚠️ ${name} pasó turno (+1 ficha)`;
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 3000);
            document.getElementById('history').innerHTML = `<div style="color:#e67e22; padding:5px; font-size:0.9em;">> ${name} pasó turno</div>` + document.getElementById('history').innerHTML;
        });
        socket.on('new-word-on-board', d => {
            document.getElementById('history').innerHTML = `<div style="padding:5px; border-bottom:1px solid #333"><b>${d.word}</b>: +${d.puntosTurno}</div>` + document.getElementById('history').innerHTML;
            d.word.split('').forEach((l, i) => {
                const x = d.vertical ? d.x : parseInt(d.x)+i, y = d.vertical ? parseInt(d.y)+i : d.y;
                const cell = document.getElementById(`cell-${x}-${y}`);
                if(cell && cell.innerText === "") {
                    cell.innerText = l.toUpperCase();
                    cell.classList.add('ficha');
                }
            });
        });
    </script>
</body>
</html>
