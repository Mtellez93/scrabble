<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Scrabble TV</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px; }
        .layout { display: flex; gap: 30px; align-items: flex-start; }
        .board-container { display: grid; grid-template-columns: 45px 1fr; grid-template-rows: 45px 1fr; background: #2d3436; padding: 15px; border-radius: 10px; }
        .coords-x, .coords-y { display: grid; gap: 2px; }
        .coords-x { grid-column: 2; grid-template-columns: repeat(15, 45px); }
        .coords-y { grid-row: 2; grid-template-rows: repeat(15, 45px); }
        .label { display: flex; align-items: center; justify-content: center; font-weight: bold; color: #f1c40f; }
        #board { grid-row: 2; grid-column: 2; display: grid; grid-template-columns: repeat(15, 45px); grid-template-rows: repeat(15, 45px); gap: 2px; background: #34495e; }
        .cell { width: 45px; height: 45px; background: #ecf0f1; color: #2c3e50; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.3em; border-radius: 4px; }
        .tp { background: #e74c3c !important; } .dp { background: #ff7675 !important; }
        .ficha { background: #f1c40f !important; animation: pop 0.3s; }
        @keyframes pop { from { transform: scale(0.5); } to { transform: scale(1); } }
        .side { width: 280px; }
        .box { background: #1e272e; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #f1c40f; }
        .player-card { padding: 8px; margin-top: 5px; background: #2d3436; border-radius: 4px; display: flex; justify-content: space-between; }
        .active { border: 2px solid #f1c40f; }
    </style>
</head>
<body>
    <h1 id="room-id">SALA: --</h1>
    <div class="layout">
        <div class="board-container">
            <div></div><div id="lx" class="coords-x"></div><div id="ly" class="coords-y"></div>
            <div id="board"></div>
        </div>
        <div class="side">
            <div class="box"><h3>PUNTUACIONES</h3><div id="players"></div></div>
            <div class="box"><h3>HISTORIAL</h3><div id="history"></div></div>
        </div>
    </div>
    <script>
        const socket = io();
        const b = document.getElementById('board');
        for(let i=0; i<15; i++) {
            document.getElementById('lx').innerHTML += `<div class="label">${i}</div>`;
            document.getElementById('ly').innerHTML += `<div class="label">${i}</div>`;
            for(let j=0; j<15; j++) {
                const c = document.createElement('div');
                c.className = 'cell'; c.id = `cell-${j}-${i}`;
                if((j==0||j==7||j==14)&&(i==0||i==7||i==14)&&!(j==7&&i==7)) c.classList.add('tp');
                b.appendChild(c);
            }
        }
        socket.emit('create-game');
        socket.on('game-created', code => document.getElementById('room-id').innerText = "SALA: " + code);
        socket.on('update-game-state', s => {
            document.getElementById('players').innerHTML = s.players.map(p => `
                <div class="player-card ${p.id==s.turnOwner?'active':''}">
                    <span>${p.name}</span><b>${p.score}</b>
                </div>`).join('');
        });
        socket.on('new-word-on-board', d => {
            const h = document.getElementById('history');
            h.innerHTML = `<div>${d.word}: +${d.puntosTurno}</div>` + h.innerHTML;
            d.word.split('').forEach((l, i) => {
                const x = d.vertical ? d.x : parseInt(d.x)+i, y = d.vertical ? parseInt(d.y)+i : d.y;
                const cell = document.getElementById(`cell-${x}-${y}`);
                if(cell.innerText === "") {
                    cell.innerText = l.toUpperCase();
                    cell.classList.add('ficha');
                }
            });
        });
    </script>
</body>
</html>
