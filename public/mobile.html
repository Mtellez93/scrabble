<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrabble Control</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: sans-serif; background: #2c3e50; color: white; text-align: center; padding: 20px; }
        input, button, select { width: 100%; padding: 15px; margin: 10px 0; border-radius: 8px; border: none; font-size: 1em; }
        .atril { display: flex; justify-content: center; gap: 5px; margin: 20px 0; }
        .ficha { background: #f1c40f; color: black; padding: 10px; font-weight: bold; border-radius: 4px; min-width: 20px; }
        .btn-play { background: #27ae60; color: white; font-weight: bold; }
        .btn-play:disabled { background: #95a5a6; }
    </style>
</head>
<body>
    <div id="setup">
        <h2>Unirse a la Sala</h2>
        <input id="room" placeholder="CÓDIGO (ABCD)">
        <input id="name" placeholder="TU NOMBRE">
        <button onclick="join()" style="background:#e67e22; color:white">ENTRAR</button>
    </div>

    <div id="game" style="display:none">
        <div id="atril" class="atril"></div>
        <input id="word" placeholder="PALABRA">
        <div style="display:flex; gap:10px">
            <input id="x" type="number" placeholder="X (0-14)">
            <input id="y" type="number" placeholder="Y (0-14)">
        </div>
        <select id="vert"><option value="false">Horizontal</option><option value="true">Vertical</option></select>
        <button id="playBtn" class="btn-play" onclick="play()">ENVIAR JUGADA</button>
    </div>

    <script>
        const socket = io();
        let myRoom = "";

        function join() {
            myRoom = document.getElementById('room').value.toUpperCase();
            socket.emit('join-game', { roomCode: myRoom, playerName: document.getElementById('name').value });
        }

        socket.on('joined-success', data => {
            document.getElementById('setup').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            renderAtril(data.letras);
        });

        function renderAtril(letras) {
            document.getElementById('atril').innerHTML = letras.map(l => `<div class="ficha">${l}</div>`).join('');
        }

        socket.on('nuevas-letras', renderAtril);
        socket.on('error-juego', m => alert(m));

        socket.on('update-game-state', state => {
            const isMyTurn = socket.id === state.turnOwner;
            document.getElementById('playBtn').disabled = !isMyTurn;
            document.getElementById('playBtn').innerText = isMyTurn ? "¡TU TURNO! ENVIAR" : "ESPERA TU TURNO...";
        });

        function play() {
            socket.emit('play-word', {
                roomCode: myRoom,
                word: document.getElementById('word').value,
                x: document.getElementById('x').value,
                y: document.getElementById('y').value,
                vertical: document.getElementById('vert').value === "true"
            });
            document.getElementById('word').value = "";
        }
        
        socket.on('game-over', () => {
            document.body.innerHTML = "<h1>JUEGO TERMINADO</h1><p>Mira la TV para ver los resultados.</p>";
        });
    </script>
</body>
</html>
